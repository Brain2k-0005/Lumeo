@namespace Lumeo

<Chart Option="@_option" Width="@Width" Height="@Height" Theme="@Theme" Class="@Class" @attributes="AdditionalAttributes" />

@code {
    [Parameter] public List<string> Categories { get; set; } = new();
    [Parameter] public List<ChartSeriesData> Series { get; set; } = new();
    [Parameter] public bool Smooth { get; set; }
    [Parameter] public bool ShowDots { get; set; } = true;
    [Parameter] public bool Stacked { get; set; }
    [Parameter] public bool Gradient { get; set; } = true;
    [Parameter] public bool ShowLegend { get; set; } = true;
    [Parameter] public bool ShowTooltip { get; set; } = true;
    [Parameter] public List<string>? Colors { get; set; }
    [Parameter] public string Width { get; set; } = "100%";
    [Parameter] public string Height { get; set; } = "350px";
    [Parameter] public string? Theme { get; set; }
    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private EChartOption _option = new();

    protected override void OnParametersSet()
    {
        var areaOpacity = Gradient ? 0.3 : 0.7;

        var seriesList = Series.Select(s => new EChartSeries
        {
            Name = s.Name,
            Type = "line",
            Data = s.Values,
            Smooth = Smooth ? true : null,
            ShowSymbol = ShowDots ? null : false,
            SymbolSize = ShowDots ? 6 : null,
            Stack = Stacked ? "total" : null,
            AreaStyle = new EChartAreaStyle
            {
                Opacity = areaOpacity
            }
        }).ToList();

        _option = new EChartOption
        {
            XAxis = new List<EChartAxis>
            {
                new EChartAxis
                {
                    Type = "category",
                    Data = Categories,
                    BoundaryGap = false
                }
            },
            YAxis = new List<EChartAxis>
            {
                new EChartAxis { Type = "value" }
            },
            Series = seriesList,
            Grid = new EChartGrid
            {
                Left = "3%",
                Right = "4%",
                Top = ShowLegend ? "14%" : "5%",
                Bottom = "3%",
                ContainLabel = true
            },
            Color = Colors
        };

        if (ShowTooltip)
        {
            _option.Tooltip = new EChartTooltip
            {
                Trigger = "axis"
            };
        }

        if (ShowLegend && Series.Count > 0)
        {
            _option.Legend = new EChartLegend
            {
                Data = Series.Select(s => s.Name).ToList()
            };
        }
    }

    public class ChartSeriesData
    {
        public string Name { get; set; } = "";
        public List<double> Values { get; set; } = new();
    }
}
