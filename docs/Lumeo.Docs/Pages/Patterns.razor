@page "/patterns"
@namespace Lumeo.Docs.Pages.PatternsIndex

<PageTitle>Patterns â€” Lumeo</PageTitle>

<div class="-mx-4 sm:-mx-6 -mt-8 flex">
    <!-- Left Sidebar -->
    <aside class="hidden lg:block w-56 shrink-0 border-r sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto">
        <div class="p-4">
            <!-- Search -->
            <div class="relative mb-4">
                <Blazicon Svg="Lucide.Search" class="absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
                <input class="flex h-8 w-full rounded-md border bg-background px-3 py-1 text-xs pl-8 outline-none focus:ring-1 focus:ring-ring placeholder:text-muted-foreground text-foreground"
                       placeholder="Filter categories..."
                       @bind="_sidebarSearch"
                       @bind:event="oninput" />
            </div>

            <!-- Sidebar Items -->
            <div class="space-y-0.5">
                <button class="@SidebarItemClass("All")" @onclick='() => _selectedCategory = "All"'>
                    <span>All Patterns</span>
                    <span class="ml-auto text-xs font-medium text-muted-foreground">@_allItems.Count</span>
                </button>

                <div class="pt-2 pb-1">
                    <p class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground px-2">Full Page</p>
                </div>

                @foreach (var item in _fullPageItems.Where(p => MatchesSidebarSearch(p.Name)))
                {
                    <button class="@SidebarItemClass(item.Name)" @onclick="() => _selectedCategory = item.Name">
                        <span>@item.Name</span>
                        <span class="ml-auto text-xs font-medium text-muted-foreground">@item.Count</span>
                    </button>
                }

                <div class="pt-2 pb-1">
                    <p class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground px-2">Components</p>
                </div>

                @foreach (var item in _componentGroups.Where(p => MatchesSidebarSearch(p.Name)))
                {
                    <button class="@SidebarItemClass(item.Name)" @onclick="() => _selectedCategory = item.Name">
                        <span>@item.Name</span>
                        <span class="ml-auto text-xs font-medium text-muted-foreground">@item.Count</span>
                    </button>
                }
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 min-w-0 p-6 lg:p-8">
        <div class="space-y-6">
            <div>
                <h1 class="text-3xl font-bold tracking-tight text-foreground">Patterns</h1>
                <p class="text-muted-foreground mt-1">Real-world UI patterns built with Lumeo components. @FilteredItems.Count patterns.</p>
            </div>

            <!-- Mobile category selector -->
            <div class="lg:hidden">
                <select class="flex h-9 w-full rounded-md border bg-background px-3 py-1 text-sm outline-none focus:ring-1 focus:ring-ring text-foreground"
                        @onchange="OnMobileCategoryChange"
                        value="@_selectedCategory">
                    <option value="All">All Patterns (@_allItems.Count)</option>
                    @foreach (var item in _fullPageItems)
                    {
                        <option value="@item.Name">@item.Name (@item.Count)</option>
                    }
                    @foreach (var item in _componentGroups)
                    {
                        <option value="@item.Name">@item.Name (@item.Count)</option>
                    }
                </select>
            </div>

            <!-- Grid of pattern cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
                @foreach (var item in FilteredItems)
                {
                    <a href="@item.Href" class="no-underline group">
                        <div class="rounded-xl border bg-card p-5 h-full transition-all hover:shadow-md hover:border-primary/40">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary">
                                    <Blazicon Svg="@item.Icon" class="h-4 w-4" />
                                </div>
                                <div>
                                    <h3 class="text-sm font-semibold text-foreground group-hover:text-primary transition-colors">@item.Name</h3>
                                    <Badge Variant="Badge.BadgeVariant.Secondary" Class="mt-1 text-[10px]">@item.Category</Badge>
                                </div>
                            </div>
                            <p class="text-sm text-muted-foreground leading-relaxed">@item.Description</p>
                        </div>
                    </a>
                }
            </div>

            @if (FilteredItems.Count == 0)
            {
                <div class="flex flex-col items-center justify-center py-20 text-center space-y-3">
                    <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted">
                        <Blazicon Svg="Lucide.Search" class="h-6 w-6 text-muted-foreground" />
                    </div>
                    <p class="font-medium text-foreground">No patterns found</p>
                    <p class="text-sm text-muted-foreground">Try a different category.</p>
                    <Button Variant="Button.ButtonVariant.Ghost" Size="Button.ButtonSize.Sm" OnClick='() => _selectedCategory = "All"'>
                        Clear filter
                    </Button>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string _selectedCategory = "All";
    private string _sidebarSearch = "";

    private record PatternItem(string Name, string Category, string Description, string Href, SvgIcon Icon);
    private record SidebarItem(string Name, int Count);

    private readonly List<PatternItem> _allItems =
    [
        // Full page patterns
        new("Dashboard", "Full Page", "Analytics dashboard with charts, stats cards, and data tables.", "/patterns/dashboard", Lucide.LayoutGrid),
        new("Mail", "Full Page", "Email inbox with message list, preview pane, and compose.", "/patterns/mail", Lucide.Mail),
        new("E-Commerce", "Full Page", "Product catalog with filtering, cart, and checkout.", "/patterns/ecommerce", Lucide.ShoppingCart),
        new("Settings", "Full Page", "User settings with profile, notifications, and preferences.", "/patterns/settings", Lucide.Settings),
        new("Kanban Board", "Full Page", "Drag-and-drop task management board with columns.", "/patterns/kanban", Lucide.Box),
        new("Music Player", "Full Page", "Music streaming interface with playlists and player controls.", "/patterns/music", Lucide.Music),
        new("Chat", "Full Page", "Real-time messaging interface with contacts and threads.", "/patterns/chat", Lucide.MessageCircle),
        new("Calendar", "Full Page", "Event scheduling with month and agenda views.", "/patterns/calendar", Lucide.Calendar),
        new("Form Wizard", "Full Page", "Multi-step form with validation and progress indicator.", "/patterns/form-wizard", Lucide.ClipboardList),
        new("Filters", "Full Page", "Data filtering with operators and visual indicators.", "/patterns/filters", Lucide.Filter),

        // Component patterns
        new("Sign In", "Authentication", "Credential form with OAuth providers and forgot password.", "/patterns#auth-signin", Lucide.LogIn),
        new("Sign Up", "Authentication", "Registration form with terms acceptance and validation.", "/patterns#auth-signup", Lucide.UserPlus),
        new("Pricing", "Commerce", "Three-tier pricing table with feature comparison.", "/patterns#pricing", Lucide.CreditCard),
        new("Product Card", "Commerce", "Product display card with image, price, and actions.", "/patterns#product", Lucide.Package),
        new("Stats Cards", "Dashboard", "KPI cards with trend badges and metrics.", "/patterns#stats", Lucide.ChartBar),
        new("Analytics Chart", "Dashboard", "Revenue chart with period selector.", "/patterns#analytics", Lucide.TrendingUp),
        new("Data Table", "Data Display", "Sortable table with row selection and actions.", "/patterns#table", Lucide.Table),
        new("Activity Feed", "Data Display", "Timeline of recent events with avatars.", "/patterns#activity", Lucide.Clock),
        new("Contact Form", "Forms", "Contact form with validation and send button.", "/patterns#contact", Lucide.Send),
        new("Settings Form", "Forms", "Profile settings with toggles and preferences.", "/patterns#settings-form", Lucide.SlidersHorizontal),
        new("Notifications", "Marketing", "Notification center with read/unread status.", "/patterns#notifications", Lucide.Bell),
        new("Feature Grid", "Marketing", "Feature showcase with icons and descriptions.", "/patterns#features", Lucide.Blocks),
        new("File Upload", "Forms", "Drag-and-drop file upload with progress bar.", "/patterns#upload", Lucide.Upload),
    ];

    private List<SidebarItem> _fullPageItems => _allItems
        .Where(x => x.Category == "Full Page")
        .Select(x => new SidebarItem(x.Name, 1))
        .ToList();

    private List<SidebarItem> _componentGroups => _allItems
        .Where(x => x.Category != "Full Page")
        .GroupBy(x => x.Category)
        .Select(g => new SidebarItem(g.Key, g.Count()))
        .ToList();

    private List<PatternItem> FilteredItems => _selectedCategory == "All"
        ? _allItems
        : _allItems.Where(x => x.Name == _selectedCategory || x.Category == _selectedCategory).ToList();

    private bool MatchesSidebarSearch(string name) =>
        string.IsNullOrEmpty(_sidebarSearch) || name.Contains(_sidebarSearch, StringComparison.OrdinalIgnoreCase);

    private string SidebarItemClass(string name) =>
        $"w-full flex items-center justify-between rounded-md px-2 py-1.5 text-sm transition-colors cursor-pointer {(name == _selectedCategory ? "bg-accent text-foreground font-medium" : "text-muted-foreground hover:text-foreground hover:bg-accent/50")}";

    private void OnMobileCategoryChange(ChangeEventArgs e) =>
        _selectedCategory = e.Value?.ToString() ?? "All";
}
