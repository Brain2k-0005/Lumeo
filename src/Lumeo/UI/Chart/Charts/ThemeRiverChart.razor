@namespace Lumeo

<Chart Option="@_option" Width="@Width" Height="@Height" Theme="@Theme" Class="@Class" @attributes="AdditionalAttributes" />

@code {
    [Parameter] public List<string[]> Data { get; set; } = new();
    [Parameter] public bool ShowLegend { get; set; } = true;
    [Parameter] public bool ShowTooltip { get; set; } = true;
    [Parameter] public List<string>? Colors { get; set; }
    [Parameter] public string Width { get; set; } = "100%";
    [Parameter] public string Height { get; set; } = "350px";
    [Parameter] public string? Theme { get; set; }
    [Parameter] public string? Class { get; set; }
    [Parameter(CaptureUnmatchedValues = true)] public Dictionary<string, object>? AdditionalAttributes { get; set; }

    private EChartOption _option = new();

    protected override void OnParametersSet()
    {
        var series = new EChartSeries
        {
            Type = "themeRiver",
            Data = Data
        };

        var legendNames = Data
            .Where(d => d.Length >= 3)
            .Select(d => d[2])
            .Distinct()
            .ToList();

        _option = new EChartOption
        {
            Series = new List<EChartSeries> { series },
            SingleAxis = new EChartSingleAxis
            {
                Type = "time",
                Left = "5%",
                Right = "5%",
                Top = ShowLegend ? "15%" : "5%",
                Bottom = "10%",
                Height = "60%"
            },
            Color = Colors
        };

        if (ShowTooltip)
        {
            _option.Tooltip = new EChartTooltip { Trigger = "axis" };
        }

        if (ShowLegend && legendNames.Count > 0)
        {
            _option.Legend = new EChartLegend
            {
                Data = legendNames,
                Top = "3%"
            };
        }
    }
}
