@page "/patterns"
@namespace Lumeo.Docs.Pages.PatternsIndex

<PageTitle>Patterns â€” Lumeo</PageTitle>

<div class="-mx-4 sm:-mx-6 -mt-8 flex">
    <!-- Left Sidebar -->
    <aside class="hidden lg:block w-56 shrink-0 border-r sticky top-14 h-[calc(100vh-3.5rem)] overflow-y-auto">
        <div class="p-4">
            <!-- Search -->
            <div class="relative mb-4">
                <Blazicon Svg="Lucide.Search" class="absolute left-2.5 top-1/2 -translate-y-1/2 h-3.5 w-3.5 text-muted-foreground" />
                <input class="flex h-8 w-full rounded-md border bg-background px-3 py-1 text-xs pl-8 outline-none focus:ring-1 focus:ring-ring placeholder:text-muted-foreground text-foreground"
                       placeholder="Filter patterns..."
                       @bind="_sidebarSearch"
                       @bind:event="oninput" />
            </div>

            <!-- Sidebar Items -->
            <div class="space-y-0.5">
                <button class="@SidebarItemClass("All")" @onclick='() => _selectedCategory = "All"'>
                    <span>All Patterns</span>
                    <span class="ml-auto text-xs font-medium text-muted-foreground">@_patterns.Count</span>
                </button>

                @foreach (var group in _categories.Where(c => MatchesSidebarSearch(c.Name)))
                {
                    <div class="pt-2 pb-1">
                        <p class="text-[10px] font-semibold uppercase tracking-wider text-muted-foreground px-2">@group.Name</p>
                    </div>
                    @foreach (var p in _patterns.Where(x => x.Category == group.Name && MatchesSidebarSearch(x.Name)))
                    {
                        <button class="@SidebarItemClass(p.Name)" @onclick="() => _selectedCategory = p.Name">
                            <span>@p.Name</span>
                        </button>
                    }
                }
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 min-w-0 p-6 lg:p-8">
        <div class="space-y-6">
            <div>
                <h1 class="text-3xl font-bold tracking-tight text-foreground">Patterns</h1>
                <p class="text-muted-foreground mt-1">Real-world UI patterns built with Lumeo components. @FilteredItems.Count patterns.</p>
            </div>

            <!-- Mobile category selector -->
            <div class="lg:hidden">
                <select class="flex h-9 w-full rounded-md border bg-background px-3 py-1 text-sm outline-none focus:ring-1 focus:ring-ring text-foreground"
                        @onchange="OnMobileCategoryChange"
                        value="@_selectedCategory">
                    <option value="All">All Patterns (@_patterns.Count)</option>
                    @foreach (var group in _categories)
                    {
                        @foreach (var p in _patterns.Where(x => x.Category == group.Name))
                        {
                            <option value="@p.Name">@p.Name</option>
                        }
                    }
                </select>
            </div>

            <!-- Grid of pattern cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
                @foreach (var item in FilteredItems)
                {
                    <a href="@item.Href" class="no-underline group">
                        <div class="rounded-xl border bg-card p-5 h-full transition-all hover:shadow-md hover:border-primary/40">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="flex h-9 w-9 shrink-0 items-center justify-center rounded-lg bg-primary/10 text-primary">
                                    <Blazicon Svg="@item.Icon" class="h-4 w-4" />
                                </div>
                                <div>
                                    <h3 class="text-sm font-semibold text-foreground group-hover:text-primary transition-colors">@item.Name</h3>
                                    <Badge Variant="Badge.BadgeVariant.Secondary" Class="mt-1 text-[10px]">@item.Category</Badge>
                                </div>
                            </div>
                            <p class="text-sm text-muted-foreground leading-relaxed">@item.Description</p>
                        </div>
                    </a>
                }
            </div>

            @if (FilteredItems.Count == 0)
            {
                <div class="flex flex-col items-center justify-center py-20 text-center space-y-3">
                    <div class="flex h-14 w-14 items-center justify-center rounded-full bg-muted">
                        <Blazicon Svg="Lucide.Search" class="h-6 w-6 text-muted-foreground" />
                    </div>
                    <p class="font-medium text-foreground">No patterns found</p>
                    <p class="text-sm text-muted-foreground">Try a different category.</p>
                    <Button Variant="Button.ButtonVariant.Ghost" Size="Button.ButtonSize.Sm" OnClick='() => _selectedCategory = "All"'>
                        Clear filter
                    </Button>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string _selectedCategory = "All";
    private string _sidebarSearch = "";

    private record PatternItem(string Name, string Category, string Description, string Href, SvgIcon Icon);
    private record CategoryGroup(string Name);

    private readonly List<CategoryGroup> _categories =
    [
        new("Application"),
        new("Productivity"),
        new("Communication"),
        new("Data & Forms"),
    ];

    private readonly List<PatternItem> _patterns =
    [
        new("Dashboard", "Application", "Analytics dashboard with charts, stats cards, and data tables.", "/patterns/dashboard", Lucide.LayoutGrid),
        new("E-Commerce", "Application", "Product catalog with filtering, cart, and checkout.", "/patterns/ecommerce", Lucide.ShoppingCart),
        new("Settings", "Application", "User settings with profile, notifications, and preferences.", "/patterns/settings", Lucide.Settings),
        new("Music Player", "Application", "Music streaming interface with playlists and player controls.", "/patterns/music", Lucide.Music),
        new("Kanban Board", "Productivity", "Drag-and-drop task management board with columns.", "/patterns/kanban", Lucide.Box),
        new("Calendar", "Productivity", "Event scheduling with month and agenda views.", "/patterns/calendar", Lucide.Calendar),
        new("Form Wizard", "Productivity", "Multi-step form with validation and progress indicator.", "/patterns/form-wizard", Lucide.ClipboardList),
        new("Mail", "Communication", "Email inbox with message list, preview pane, and compose.", "/patterns/mail", Lucide.Mail),
        new("Chat", "Communication", "Real-time messaging interface with contacts and threads.", "/patterns/chat", Lucide.MessageCircle),
        new("Filters", "Data & Forms", "Data filtering with operators and visual indicators.", "/patterns/filters", Lucide.Filter),
    ];

    private List<PatternItem> FilteredItems => _selectedCategory == "All"
        ? _patterns
        : _patterns.Where(x => x.Name == _selectedCategory || x.Category == _selectedCategory).ToList();

    private bool MatchesSidebarSearch(string name) =>
        string.IsNullOrEmpty(_sidebarSearch) || name.Contains(_sidebarSearch, StringComparison.OrdinalIgnoreCase);

    private string SidebarItemClass(string name) =>
        $"w-full flex items-center justify-between rounded-md px-2 py-1.5 text-sm transition-colors cursor-pointer {(name == _selectedCategory ? "bg-accent text-foreground font-medium" : "text-muted-foreground hover:text-foreground hover:bg-accent/50")}";

    private void OnMobileCategoryChange(ChangeEventArgs e) =>
        _selectedCategory = e.Value?.ToString() ?? "All";
}
